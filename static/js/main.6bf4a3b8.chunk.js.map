{"version":3,"sources":["worker/offscreen.worker.js","components/image-input/image-input.module.scss","components/image-handler/image-handler.module.scss","webpack:///./src/worker/offscreen.worker.js?a916","utils/image.helper.js","utils/dom.helper.js","components/image-input/index.js","utils/constants.js","components/image-handler/index.js","app.js","index.js","app.module.scss"],"names":["module","exports","wrap","__esModule","Worker","drawImageByBlock","data","tasks","map","i","window","createImageBitmap","imgRef","Promise","all","then","bitmaps","img","sy","topPos","sh","selectH","containerHeight","offsetHeight","realSy","naturalHeight","realSh","parseInt","removeChildren","node","type","last","querySelector","removeChild","ImageInput","inputRef","React","createRef","state","files","previewUrls","handleImageChosen","ev","target","props","onSelectImages","length","res","Array","from","f","URL","createObjectURL","setState","onFilesReady","className","s","imageInput","accept","multiple","id","fileInput","ref","this","onChange","color","size","htmlFor","Component","MIN_GAP","ImageHandler","topRef","botRef","containerRef","botPos","locked","forceLocked","generateCropped","always","onCollectImageData","imageIdx","onImgLoad","onImageLoad","height","naturalWidth","shouldUpdatePos","nState","updateState","_val","isTopOne","cb","val","gap","prop","handleDragStart","offsetTop","pageY","pos","handleDrop","getRef","refName","el","imageSrc","imageHandlerContainer","style","width","ctlGroup","cn","removeImg","onClick","onRemoveImage","imgContainer","alt","draggable","src","onLoad","overlayIndicator","top","selectHandler","onDrag","onDragEnd","bottom","App","imageData","canDownload","selectImages","len","p","fill","handleFiles","concat","idx","a","newImageData","slice","drawPreview","generateImg","download","preventDefault","downloadImage","Comlink","blob","saveAs","images","container","document","canvas","createElement","appendChild","offscreen","transferControlToOffscreen","drawOffscreenCanvas","dw","collectImageData","next","shouldShowPreview","every","Boolean","file","revokeObjectURL","renderImgHandler","extraOption","app","btnGroup","href","pinnBtn","selectedPics","fileList","finalPreview","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.6bf4a3b8.chunk.js","sourcesContent":["module.exports = require('comlink').wrap(require(\"!worker-loader?{}!/Users/al/code/pinn/node_modules/comlink-loader/dist/comlink-worker-loader.js!/Users/al/code/pinn/node_modules/babel-loader/lib/index.js??ref--5-oneOf-2!/Users/al/code/pinn/src/worker/offscreen.worker.js\")());module.exports.__esModule = true;","// extracted by mini-css-extract-plugin\nmodule.exports = {\"image-input\":\"image-input_image-input__1ZpqQ\",\"imageInput\":\"image-input_image-input__1ZpqQ\",\"file-input\":\"image-input_file-input__O7iAO\",\"fileInput\":\"image-input_file-input__O7iAO\",\"trigger\":\"image-input_trigger__1Ov2N\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"image-handler-container\":\"image-handler_image-handler-container__2LVQd\",\"imageHandlerContainer\":\"image-handler_image-handler-container__2LVQd\",\"ctl-group\":\"image-handler_ctl-group__2Hncg\",\"ctlGroup\":\"image-handler_ctl-group__2Hncg\",\"select-handler\":\"image-handler_select-handler__3EKfk\",\"selectHandler\":\"image-handler_select-handler__3EKfk\",\"overlay-indicator\":\"image-handler_overlay-indicator__1IGeu\",\"overlayIndicator\":\"image-handler_overlay-indicator__1IGeu\"};","module.exports = function() {\n  return new Worker(__webpack_public_path__ + \"c4638173e2d95ea8dcdc.worker.js\");\n};","export const drawImageByBlock = data => {\n  const tasks = data.map(i => window.createImageBitmap(i.imgRef))\n\n  return Promise.all(tasks)\n    .then(bitmaps => {\n      const imgData = data.map(i => {\n        const {\n          imgRef: img,\n          topPos: sy,\n          selectH: sh,\n          offsetHeight: containerHeight,\n        } = i;\n\n        const realSy = (img.naturalHeight / containerHeight) * sy\n        const realSh = (img.naturalHeight / containerHeight) * sh\n\n        return {\n          realSy: parseInt(realSy, 10),\n          realSh: parseInt(realSh, 10),\n        }\n      })\n\n      return [bitmaps, imgData]\n    })\n}\n","export const removeChildren = (node, type) => {\n  let last = node.querySelector(type)\n  while (last) {\n    node.removeChild(last)\n    last = node.querySelector(type)\n  }\n}\n","import s from './image-input.module.scss'\n\nimport React from 'react'\nimport { Upload } from 'react-feather'\n\nexport default class ImageInput extends React.Component {\n  inputRef = React.createRef()\n\n  state = {\n    files: [],\n    previewUrls: []\n  }\n\n  handleImageChosen = ev => {\n    const files = ev.target.files\n\n    this.props.onSelectImages(files.length || 0)\n    const res = Array.from(files)\n      .map(f => window.URL.createObjectURL(f))\n\n    this.setState({\n      files: res\n    })\n    this.props.onFilesReady(res)\n  }\n\n  render() {\n    return (\n      <div className={s.imageInput}>\n        <input\n          type='file'\n          accept='image/*'\n          multiple='multiple'\n          id={`file-input`}\n          className={s.fileInput}\n          ref={this.inputRef}\n          onChange={this.handleImageChosen}\n        />\n        <Upload color={`#18BA88`} size={`2.6rem`}/>\n        <label htmlFor=\"file-input\">Choose file(s)</label>\n      </div>\n    )\n  }\n}\n","export const MIN_GAP = 20;\n\nexport const IMAGE_WIDTH = 500;","import s from './image-handler.module.scss'\n\nimport React from 'react'\nimport cn from 'classnames'\n\nimport { IMAGE_WIDTH, MIN_GAP } from 'src/utils/constants'\n\nexport default class ImageHandler extends React.Component {\n  topRef = null\n  botRef = null\n  containerRef = null\n  imgRef = null\n\n  state = {\n    topPos: this.props.topPos || 100,\n    botPos: this.props.botPos || 20,\n    containerHeight: 'unset',\n    locked: !!this.props.forceLocked,\n  }\n\n  generateCropped = (always = false) => {\n    const { offsetHeight } = this.containerRef\n    const { topPos, botPos } = this.state\n    const selectH = offsetHeight - topPos - botPos\n\n    this.props.onCollectImageData(this.imgRef, topPos, selectH, offsetHeight, this.props.imageIdx, always)\n  }\n\n  onImgLoad = () => {\n    this.props.onImageLoad(this.imgRef)\n\n    const { naturalHeight, naturalWidth } = this.imgRef\n    const height = (naturalHeight / naturalWidth) * IMAGE_WIDTH\n\n    const shouldUpdatePos = !this.props.topPos\n    const nState = {\n      containerHeight: `${height}px`,\n    }\n\n    if (shouldUpdatePos) {\n      const { botPos } = this.state\n      nState.topPos = height - botPos - 100\n    }\n\n    this.setState({ ...nState }, () => {\n      this.generateCropped()\n    })\n  }\n\n  updateState = (_val, isTopOne = true, cb) => {\n    const { offsetHeight } = this.containerRef\n    const { topPos, botPos } = this.state\n\n    let val = _val\n    let gap = offsetHeight - botPos - val\n    if (!isTopOne) {\n      gap = offsetHeight - val - topPos\n    }\n\n    if (gap < MIN_GAP) {\n      val = offsetHeight - botPos - MIN_GAP\n      if (!isTopOne) {\n        val = offsetHeight - topPos - MIN_GAP\n      }\n    }\n\n    let prop = isTopOne ? 'topPos' : 'botPos'\n    this.setState({\n      [prop]: val\n    }, () => {\n      cb && cb()\n    })\n  }\n\n  handleDragStart = (isTopOne = true) => ev => {\n    const { offsetTop, offsetHeight } = this.containerRef\n    const { pageY } = ev\n\n    let pos = pageY - offsetTop\n    if (!isTopOne) {\n      pos = offsetHeight + offsetTop - pageY\n    }\n\n    this.updateState(pos, isTopOne)\n  }\n\n  handleDrop = (isTopOne = true) => ev => {\n    const { offsetTop, offsetHeight } = this.containerRef\n    const barPosition = ev.pageY\n\n    let pos = barPosition - offsetTop\n    if (!isTopOne) {\n      pos = offsetHeight - pos\n    }\n    if (pos < 0) {\n      pos = 0\n    }\n\n    this.updateState(pos, isTopOne, () => this.generateCropped(true))\n  }\n\n  getRef = refName => el => {\n    this[refName] = el\n  }\n\n  render() {\n    const { imageSrc } = this.props\n    const { topPos, botPos, containerHeight, } = this.state\n\n    return (\n      <div\n        className={s.imageHandlerContainer}\n        style={{\n          width: `${IMAGE_WIDTH}px`,\n          height: containerHeight\n        }}\n        ref={this.getRef('containerRef')}\n      >\n        <div className={s.ctlGroup}>\n          <span className={cn(`icon`, s.removeImg)}>\n            <i\n              className='ion ion-md-close'\n              onClick={this.props.onRemoveImage}\n            />\n          </span>\n          {/*\n          <span className='icon lock-img'>\n            <i\n              className={`ion ${locked ? 'ion-md-lock' : 'ion-md-unlock'}`}\n              onClick={this.toggleLock}\n            />\n          </span>\n*/}\n        </div>\n\n        <img\n          className={s.imgContainer}\n          alt={''}\n          draggable={false}\n          src={imageSrc}\n          ref={this.getRef('imgRef')}\n          onLoad={this.onImgLoad}\n        />\n\n        <div\n          className={s.overlayIndicator}\n          style={{\n            top: 0,\n            height: `${topPos}px`,\n          }}\n        />\n\n        <div\n          className={cn(s.selectHandler, s.top)}\n          style={{\n            top: `${topPos}px`\n          }}\n          ref={this.getRef('topRef')}\n          draggable={true}\n          onDrag={this.handleDragStart()}\n          onDragEnd={this.handleDrop()}\n        />\n\n        <div\n          className={cn(s.selectHandler, s.bottom)}\n          style={{\n            bottom: `${botPos}px`\n          }}\n          ref={this.getRef('botRef')}\n          draggable={true}\n          onDrag={this.handleDragStart(false)}\n          onDragEnd={this.handleDrop(false)}\n        />\n\n        <div\n          className={s.overlayIndicator}\n          style={{\n            bottom: 0,\n            height: `${botPos}px`,\n          }}\n        />\n\n      </div>\n    )\n  }\n}\n","import s from './app.module.scss';\r\n\r\nimport * as Comlink from 'comlink';\r\nimport { saveAs } from 'file-saver'\r\n\r\nimport React, { Component } from 'react'\r\nimport cn from 'classnames'\r\nimport { DownloadCloud } from 'react-feather'\r\n\r\nimport { drawImageByBlock } from 'src/utils/image.helper'\r\nimport { removeChildren } from 'src/utils/dom.helper'\r\n// eslint-disable-next-line import/no-webpack-loader-syntax\r\nimport { drawOffscreenCanvas, downloadImage } from 'comlink-loader?singleton!src/worker/offscreen.worker';\r\n\r\nimport ImageInput from 'src/components/image-input'\r\nimport ImageHandler from 'src/components/image-handler'\r\n\r\nclass App extends Component {\r\n  state = {\r\n    previewUrls: [],\r\n    imageData: [],\r\n    files: [],\r\n    canDownload: false,\r\n  }\r\n\r\n  selectImages = len => {\r\n    this.setState(p => ({\r\n      imageData: [\r\n        ...p.imageData,\r\n        ...Array(len).fill(null)\r\n      ]\r\n    }))\r\n  }\r\n\r\n  handleFiles = files => {\r\n    this.setState(p => ({\r\n      files: p.files.concat(files),\r\n    }))\r\n  }\r\n\r\n  removeImg = idx => async () => {\r\n    const { previewUrls, imageData, files } = this.state\r\n\r\n    const newImageData = [\r\n      ...imageData.slice(0, idx),\r\n      ...imageData.slice(idx + 1)\r\n    ]\r\n    this.setState({\r\n      files: [\r\n        ...files.slice(0, idx),\r\n        ...files.slice(idx + 1),\r\n      ],\r\n      previewUrls: [\r\n        ...previewUrls.slice(0, idx),\r\n        ...previewUrls.slice(idx + 1)\r\n      ],\r\n      imageData: newImageData\r\n    })\r\n\r\n    await this.drawPreview(newImageData)\r\n  }\r\n\r\n  generateImg = async () => {\r\n    await this.drawPreview(this.state.imageData)\r\n  }\r\n\r\n  // todo: may be laggy\r\n  download = async ev => {\r\n    ev.preventDefault()\r\n    const [bitmaps, data] = await drawImageByBlock(this.state.imageData)\r\n    const blob = await downloadImage(Comlink.transfer({ bitmaps, data }, bitmaps))\r\n    await saveAs(blob, `pinn-image.png`)\r\n  }\r\n\r\n  drawPreview = async images => {\r\n    const [bitmaps, data] = await drawImageByBlock(images)\r\n    const dw = 300\r\n\r\n    const container = document.querySelector(`#final-preview`)\r\n    removeChildren(container, 'CANVAS')\r\n\r\n    const canvas = document.createElement(`canvas`)\r\n    container.appendChild(canvas)\r\n    const offscreen = canvas.transferControlToOffscreen()\r\n    await drawOffscreenCanvas(Comlink.transfer({ data, bitmaps, dw, offscreen }, [...bitmaps, offscreen]))\r\n    this.setState({\r\n      canDownload: true\r\n    })\r\n  }\r\n\r\n  collectImageData = (imgRef, topPos, selectH, offsetHeight, imageIdx, always = false) => {\r\n    const { imageData } = this.state\r\n    const next = [\r\n      ...imageData.slice(0, imageIdx),\r\n      { imgRef, topPos, selectH, offsetHeight, imageIdx },\r\n      ...imageData.slice(imageIdx + 1)\r\n    ]\r\n\r\n    this.setState({\r\n      imageData: next\r\n    })\r\n\r\n    const shouldShowPreview = next.every(Boolean) || always\r\n    shouldShowPreview && this.drawPreview(next)\r\n  }\r\n\r\n  onImageLoad = file => () => {\r\n    window.URL.revokeObjectURL(file)\r\n  }\r\n\r\n  renderImgHandler = (file, idx) => {\r\n    let extraOption = {}\r\n    if (!idx) {\r\n      extraOption = {\r\n        topPos: 1,\r\n        botPos: 1,\r\n        forceLocked: true\r\n      }\r\n    }\r\n\r\n    return <ImageHandler\r\n      key={`img-${file}`}\r\n      imageIdx={idx}\r\n      imageSrc={file}\r\n      onRemoveImage={this.removeImg(idx)}\r\n      onCollectImageData={this.collectImageData}\r\n      onImageLoad={this.onImageLoad(file)}\r\n      {...extraOption}\r\n    />\r\n  }\r\n\r\n  render() {\r\n    const { files, canDownload } = this.state\r\n\r\n    return (\r\n      <div className={s.app}>\r\n        <ImageInput\r\n          onFilesReady={this.handleFiles}\r\n          onSelectImages={this.selectImages}\r\n        />\r\n\r\n        <div className={s.btnGroup}>\r\n          <a\r\n            href='#pinn-btn'\r\n            className={cn('button is-link is-light', s.pinnBtn)}\r\n            onClick={this.generateImg}\r\n          >\r\n            Pinn!\r\n          </a>\r\n        </div>\r\n\r\n        <div\r\n          className={s.selectedPics}\r\n        >\r\n          <div className={s.fileList}>\r\n            {files.length > 0\r\n            && files.map(this.renderImgHandler)}\r\n          </div>\r\n\r\n          <div id={'final-preview'} className={s.finalPreview}>\r\n            {\r\n              canDownload &&\r\n                <div className={s.download}>\r\n                  <DownloadCloud\r\n                    color={`#fd0f5e`}\r\n                    size={`5rem`}\r\n                    onClick={this.download}\r\n                  />\r\n                </div>\r\n            }\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default App;\r\n","import './index.css';\n\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './app';\n// import * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\n// serviceWorker.unregister();\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"app\":\"app_app__3mk8F\",\"selected-pics\":\"app_selected-pics__3hYXn\",\"selectedPics\":\"app_selected-pics__3hYXn\",\"file-list\":\"app_file-list__3Ve_J\",\"fileList\":\"app_file-list__3Ve_J\",\"preview\":\"app_preview__3Z6mu\",\"btn\":\"app_btn__1lQJS\",\"btn-group\":\"app_btn-group__3gpA1\",\"btnGroup\":\"app_btn-group__3gpA1\",\"finalPreview\":\"app_finalPreview__1ep57\",\"download\":\"app_download__khK-j\",\"pinn-btn\":\"app_pinn-btn__1WLIM\",\"pinnBtn\":\"app_pinn-btn__1WLIM\"};"],"sourceRoot":""}